<scene>
	<!-- Independent sample generator, user-selected samples per pixel -->
	<sampler type="independent">
		<integer name="sampleCount" value="128"/>
	</sampler>

	<integrator type="vol_path" />

	<!-- Render the scene as viewed by a perspective camera -->
	<camera type="perspective">
		<transform name="toWorld">
			<lookat target="0,0,0" origin="0,10,2" up="0,0,1"/>
		</transform>

		<float name="fov" value="70"/>

		<integer name="width" value="1920"/>
		<integer name="height" value="1080"/>
	</camera>

	<!-- Earth -->
	<!-- TODO: since we cannot rotate a sphere, we might want to use a sphere mesh-->
	<mesh type="sphere">
		<point name="center" value="0  -10 -50" />
        <float name="radius" value="42"/>

        <bsdf type="diffuse">
            <texture type="image_texture" name="albedo">
                <string name="filename" value="/textures/earth8k.png"/>
				<vector name="scale" value="1.5, 1.5"/>
            </texture>
        </bsdf>
	</mesh>

	<!-- Asteroid field -->
	<mesh type="obj">
		<string name="filename" value="/models/asteroids.obj"/>
			<bsdf type="diffuse">
            <texture type="image_texture" name="albedo">
                <string name="filename" value="/textures/meteorite.png"/>
            </texture>
        </bsdf>

		<transform name="toWorld">
			<scale value="0.2 0.2 0.2"/>
			<rotate axis="1,0,0" angle="90"/>
			<translate value="0,-35,0"/>
			
		</transform>
	</mesh>

	<!-- Locomotive -->
	<mesh type="obj">
		<!-- I had to remove the wagon from the model because the original model requires a separate texture for the wagon -->
		<!-- TODO (gimoro): add separate wagon model -->
		<string name="filename" value="/models/locomotive.obj"/>

		<!-- TODO: use DisneyBSDF, with a metallic (or something else) effect -->
		<bsdf type="diffuse">
			<!-- For some reason models are mirrored, thus I had to flip the numbers in the texture.
				Note: flipping the whole model (with scale="1, 1, -1") does correclty flip the model 
				but causes weird issues with the textures in some parts of the model...
				nori at its finest once again...-->
			
			<texture type="image_texture" name="albedo">
                <string name="filename" value="/textures/locomotive_diffuse_mirrored.png"/>
            </texture>
		</bsdf>

		<transform name="toWorld">
			<rotate axis="1,0,0" angle="90"/>
			<rotate axis="0,0,1" angle="115"/>
			<translate value="0,-6,-2.5"/>
		</transform>
	</mesh>

	<!-- Background -->
	<mesh type="obj">
		<string name="filename" value="/models/plane.obj"/>

		<!--<bsdf type="diffuse">
            <texture type="image_texture" name="albedo">
                <string name="filename" value="/textures/starmap.png"/>
				<vector name="scale" value="30, 30"/>
            </texture>
        </bsdf>-->

		<emitter type="area">
			<texture type="image_texture" name="albedo">
                <string name="filename" value="/textures/starmap.png"/>
				<vector name="scale" value="5, 5"/>
            </texture>
		</emitter>

		<transform name="toWorld">
			<scale value="500 500 500"/>
			<translate value="0,-1000,0"/>
		</transform>
	</mesh>


	<!-- Volumes -->
	<!-- Locomotive Smoke -->
	<medium type="heterogeneous">
        <phase type="isotropic"/>
        <color name="sigma_a" value="0.8,0.8,0.8"/>
        <color name="sigma_s" value="2,2,2"/>

		<!-- TODO (gimoro): maybe find a better smoke volume -->
		<integer name="density_type" value="2"/>
		<string name="volume_grid" value="/volume_grids/locomotive-smoke.nvdb"/>

		<!-- TODO (gimoro): fix position -->
        <vector name="center" value="-0.8 0 3.4"/>
        <vector name="size" value="2 2 2"/>

		<transform name="toWorld">
			<rotate axis="1,0,0" angle="-10"/>
			<rotate axis="0,0,1" angle="-90"/>
		</transform>
    </medium>

	<!-- Earth Clouds/Atomsphere -->
	<!-- I tried out a new medium type, but idk...
		 it also results in quite a few "computed invalid radiance value" -->
	<!--<medium type="heterogeneous">
        <phase type="isotropic"/>
        <color name="sigma_a" value="0.01, 0.05, 0.1"/>
        <color name="sigma_s" value="0,0.05,0.05"/>

		<integer name="density_type" value="4"/>
		<float name="exp_b" value="5"/>

        <vector name="center" value="0  -10 -50"/>
        <float name="min_radius" value="42"/>
        <float name="max_radius" value="43"/>
    </medium>-->


	<!-- Lights -->
	<!-- TODO: fix -->

	<emitter type="point">
		<point name="position" value="0,-60,-30"/>
		<color name="power" value="8000,8000,8000"/>
	</emitter>

	<emitter type="point">
		<point name="position" value="10,10,0"/>
		<color name="power" value="10000,10000,10000"/>
	</emitter>

	<emitter type="point">
		<point name="position" value="0,10,0"/>
		<color name="power" value="10000,10000,10000"/>
	</emitter>

	<emitter type="point">
		<point name="position" value="-10,10,0"/>
		<color name="power" value="1000,1000,1000"/>
	</emitter>

</scene>
